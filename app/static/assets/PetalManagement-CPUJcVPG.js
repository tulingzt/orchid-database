import{u as v,w as T,F}from"./FileSaver.min-DV60ARKV.js";import{u as U}from"./petal-DWJvgA2G.js";import{D as z}from"./DataTable-4gAKRNCn.js";import{d as B,r as _,a as P,c as q,b as a,w as r,e as f,m as c,o as $,i as b}from"./index-CrBMAzv8.js";const j={class:"management-container"},H=B({__name:"PetalManagement",setup(O){const l=U(),d=_(!1),h=_(""),w=_(),g=_(null),V=_("create"),x=[{prop:"petal_id",label:"ID",width:80},{prop:"flower_id",label:"花朵ID"},{prop:"petal_length",label:"长度(cm)"},{prop:"petal_width",label:"宽度(cm)"},{prop:"petal_ratio",label:"长宽比"},{prop:"petal_area",label:"面积(cm²)"}],n=P({flower_id:0,petal_length:0,petal_width:0,petal_area:void 0}),I={flower_id:[{required:!0,message:"请选择花朵",trigger:"blur"}],petal_length:[{required:!0,message:"请输入长度",trigger:"blur"}],petal_width:[{required:!0,message:"请输入宽度",trigger:"blur"}]},y=(o,e)=>{var i;V.value=o,h.value=o==="create"?"新增花瓣":"编辑花瓣",o==="edit"&&e?(g.value=e.petal_id,Object.assign(n,{flower_id:e.flower_id,petal_length:e.petal_length,petal_width:e.petal_width,petal_area:e.petal_area})):(g.value=null,(i=w.value)==null||i.resetFields()),d.value=!0},C=async()=>{await w.value.validate();try{V.value==="create"?await l.createItem(n):g.value&&await l.updateItem(g.value,n),d.value=!1,l.fetchItems()}catch(o){console.error(o)}},D=async o=>{try{await l.deleteItem(o.petal_id),l.fetchItems()}catch(e){console.error(e)}},S=o=>{l.pagination.page=o,l.fetchItems()},E=o=>{l.pagination.limit=o,l.fetchItems()},N=()=>{const o=l.items.map(m=>{const u={};return x.forEach(t=>{if(t.prop==="petal_ratio"){const k=m.petal_length/m.petal_width;u[t.label]=Number.isNaN(k)?0:Number(k.toFixed(2))}else u[t.label]=m[t.prop]}),u}),e=v.json_to_sheet(o),i=v.book_new();v.book_append_sheet(i,e,"花瓣数据");const s=T(i,{bookType:"xlsx",type:"array"}),p=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});F.saveAs(p,`花瓣数据_${new Date().toISOString().slice(0,10)}.xlsx`)};return l.fetchItems(),(o,e)=>{const i=f("el-button"),s=f("el-input-number"),p=f("el-form-item"),m=f("el-form"),u=f("el-dialog");return $(),q("div",j,[a(i,{type:"primary",onClick:e[0]||(e[0]=t=>y("create"))},{default:r(()=>e[8]||(e[8]=[b("新增花瓣")])),_:1}),a(i,{type:"success",onClick:N},{default:r(()=>e[9]||(e[9]=[b("导出Excel")])),_:1}),a(z,{columns:x,data:c(l).items,total:c(l).pagination.total,"page-size":c(l).pagination.limit,loading:c(l).loading,"show-actions":!0,onPageChange:S,onSizeChange:E,onEdit:e[1]||(e[1]=t=>y("edit",t)),onDelete:D},null,8,["data","total","page-size","loading"]),a(u,{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=t=>d.value=t),title:h.value},{footer:r(()=>[a(i,{onClick:e[6]||(e[6]=t=>d.value=!1)},{default:r(()=>e[10]||(e[10]=[b("取消")])),_:1}),a(i,{type:"primary",onClick:C},{default:r(()=>e[11]||(e[11]=[b("确认")])),_:1})]),default:r(()=>[a(m,{model:n,rules:I,ref_key:"formRef",ref:w},{default:r(()=>[a(p,{label:"花朵ID",prop:"flower_id"},{default:r(()=>[a(s,{modelValue:n.flower_id,"onUpdate:modelValue":e[2]||(e[2]=t=>n.flower_id=t),min:1},null,8,["modelValue"])]),_:1}),a(p,{label:"花瓣长度(cm)",prop:"petal_length"},{default:r(()=>[a(s,{modelValue:n.petal_length,"onUpdate:modelValue":e[3]||(e[3]=t=>n.petal_length=t),min:.1,precision:2},null,8,["modelValue"])]),_:1}),a(p,{label:"花瓣宽度(cm)",prop:"petal_width"},{default:r(()=>[a(s,{modelValue:n.petal_width,"onUpdate:modelValue":e[4]||(e[4]=t=>n.petal_width=t),min:.1,precision:2},null,8,["modelValue"])]),_:1}),a(p,{label:"花瓣面积(cm²)"},{default:r(()=>[a(s,{modelValue:n.petal_area,"onUpdate:modelValue":e[5]||(e[5]=t=>n.petal_area=t),min:.1,precision:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{H as default};
