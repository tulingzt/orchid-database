import{u as V,w as U,F as z}from"./FileSaver.min-DV60ARKV.js";import{u as B}from"./sepal-B7aOC8D_.js";import{D as N}from"./DataTable-4gAKRNCn.js";import{d as q,r as u,a as $,c as j,b as a,w as n,e as _,m as g,o as P,i as b}from"./index-CrBMAzv8.js";const R={class:"management-container"},H=q({__name:"SepalManagement",setup(A){const t=B(),d=u(!1),x=u(""),w=u(),f=u(null),y=u("create"),v=[{prop:"sepal_id",label:"ID",width:80},{prop:"flower_id",label:"花朵ID"},{prop:"sepal_length",label:"长度(cm)"},{prop:"sepal_width",label:"宽度(cm)"},{prop:"sepal_ratio",label:"长宽比"},{prop:"sepal_area",label:"面积(cm²)"}],s=$({flower_id:0,sepal_length:0,sepal_width:0,sepal_area:void 0}),C={flower_id:[{required:!0,message:"请选择花朵",trigger:"blur"}],sepal_length:[{required:!0,message:"请输入长度",trigger:"blur"}],sepal_width:[{required:!0,message:"请输入宽度",trigger:"blur"}]},k=(o,e)=>{var r;y.value=o,x.value=o==="create"?"新增萼片":"编辑萼片",o==="edit"&&e?(f.value=e.sepal_id,Object.assign(s,{flower_id:e.flower_id,sepal_length:e.sepal_length,sepal_width:e.sepal_width,sepal_area:e.sepal_area})):(f.value=null,(r=w.value)==null||r.resetFields()),d.value=!0},D=async()=>{await w.value.validate();try{y.value==="create"?await t.createItem(s):f.value&&await t.updateItem(f.value,s),d.value=!1,t.fetchItems()}catch(o){console.error(o)}},S=async o=>{try{await t.deleteItem(o.sepal_id),t.fetchItems()}catch(e){console.error(e)}},E=o=>{t.pagination.page=o,t.fetchItems()},F=o=>{t.pagination.limit=o,t.fetchItems()},T=()=>{const o=t.items.map(m=>{const l={};return v.forEach(c=>{if(c.prop==="sepal_ratio"){const I=m.sepal_length/m.sepal_width;l[c.label]=Number.isFinite(I)?Number(I.toFixed(2)):0}else l[c.label]=m[c.prop]}),l}),e=V.json_to_sheet(o),r=v.map(()=>({wch:15}));e["!cols"]=r;const i=V.book_new();V.book_append_sheet(i,e,"萼片数据");const p=U(i,{bookType:"xlsx",type:"array",cellStyles:!0}),h=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});z.saveAs(h,`萼片数据_${new Date().toLocaleDateString().replace(/\//g,"-")}.xlsx`)};return t.fetchItems(),(o,e)=>{const r=_("el-button"),i=_("el-input-number"),p=_("el-form-item"),h=_("el-form"),m=_("el-dialog");return P(),j("div",R,[a(r,{type:"primary",onClick:e[0]||(e[0]=l=>k("create"))},{default:n(()=>e[8]||(e[8]=[b("新增萼片")])),_:1}),a(r,{type:"success",onClick:T},{default:n(()=>e[9]||(e[9]=[b("导出Excel")])),_:1}),a(N,{columns:v,data:g(t).items,total:g(t).pagination.total,"page-size":g(t).pagination.limit,loading:g(t).loading,"show-actions":!0,onPageChange:E,onSizeChange:F,onEdit:e[1]||(e[1]=l=>k("edit",l)),onDelete:S},null,8,["data","total","page-size","loading"]),a(m,{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=l=>d.value=l),title:x.value},{footer:n(()=>[a(r,{onClick:e[6]||(e[6]=l=>d.value=!1)},{default:n(()=>e[10]||(e[10]=[b("取消")])),_:1}),a(r,{type:"primary",onClick:D},{default:n(()=>e[11]||(e[11]=[b("确认")])),_:1})]),default:n(()=>[a(h,{model:s,rules:C,ref_key:"formRef",ref:w},{default:n(()=>[a(p,{label:"花朵ID",prop:"flower_id"},{default:n(()=>[a(i,{modelValue:s.flower_id,"onUpdate:modelValue":e[2]||(e[2]=l=>s.flower_id=l),min:1},null,8,["modelValue"])]),_:1}),a(p,{label:"萼片长度(cm)",prop:"sepal_length"},{default:n(()=>[a(i,{modelValue:s.sepal_length,"onUpdate:modelValue":e[3]||(e[3]=l=>s.sepal_length=l),min:.1,precision:2},null,8,["modelValue"])]),_:1}),a(p,{label:"萼片宽度(cm)",prop:"sepal_width"},{default:n(()=>[a(i,{modelValue:s.sepal_width,"onUpdate:modelValue":e[4]||(e[4]=l=>s.sepal_width=l),min:.1,precision:2},null,8,["modelValue"])]),_:1}),a(p,{label:"萼片面积(cm²)"},{default:n(()=>[a(i,{modelValue:s.sepal_area,"onUpdate:modelValue":e[5]||(e[5]=l=>s.sepal_area=l),min:.1,precision:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{H as default};
