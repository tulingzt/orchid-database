import{u as k,w as q,F}from"./FileSaver.min-DV60ARKV.js";import{u as z}from"./species-BWpo-cmh.js";import{D as B}from"./DataTable-4gAKRNCn.js";import{d as $,r as m,a as j,c as M,b as t,w as s,e as d,m as _,o as N,i as y}from"./index-CrBMAzv8.js";import"./species-Hor55KY_.js";const O={class:"management-container"},K=$({__name:"SpeciesManagement",setup(P){const o=z(),p=m(!1);var V=m();const g=m(),b=m(null),w=m("create"),C=[{prop:"species_id",label:"ID",width:80},{prop:"family",label:"科名"},{prop:"genus",label:"属名"},{prop:"scientific_name",label:"学名"},{prop:"chinese_name",label:"中文名"},{prop:"conservation_status",label:"保护级别"}],a=j({family:"",genus:"",scientific_name:"",chinese_name:"",distribution:"",conservation_status:"无危"}),S={family:[{required:!0,message:"请输入科名",trigger:"blur"}],genus:[{required:!0,message:"请输入属名",trigger:"blur"}],scientific_name:[{required:!0,message:"请输入学名",trigger:"blur"}],chinese_name:[{required:!0,message:"请输入中文名",trigger:"blur"}],conservation_status:[{required:!0}]},I=(n,e)=>{var i,r;w.value=n,n==="edit"&&e?(V=m("编辑物种"),b.value=e.species_id,(i=g.value)==null||i.resetFields(),Object.assign(a,{family:e.family,genus:e.genus,scientific_name:e.scientific_name,chinese_name:e.chinese_name,distribution:e.distribution,conservation_status:e.conservation_status})):(V=m("新增物种"),b.value=null,(r=g.value)==null||r.resetFields()),p.value=!0},h=async()=>{await g.value.validate();try{w.value==="create"?await o.createItem(a):b.value&&await o.updateItem(b.value,a),p.value=!1,o.fetchItems()}catch(n){console.error(n)}},D=async n=>{try{await o.deleteItem(n.species_id),o.fetchItems()}catch(e){console.error(e)}},U=n=>{o.pagination.page=n,o.fetchItems()},E=n=>{o.pagination.limit=n,o.fetchItems()},T=()=>{const n=[...C,{prop:"distribution",label:"分布信息"}],e=o.items.map(f=>{const v={};return n.forEach(l=>{v[l.label]=f[l.prop]||""}),v}),i=k.json_to_sheet(e),r=n.map(f=>({wch:Math.max(f.label.length*2,12)}));i["!cols"]=r;const u=k.book_new();k.book_append_sheet(u,i,"物种数据");const c=q(u,{bookType:"xlsx",type:"array",cellStyles:!0}),x=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});F.saveAs(x,`物种数据_${new Date().toISOString().slice(0,10)}.xlsx`)};return o.fetchItems(),(n,e)=>{const i=d("el-button"),r=d("el-input"),u=d("el-form-item"),c=d("el-option"),x=d("el-select"),f=d("el-form"),v=d("el-dialog");return N(),M("div",O,[t(i,{type:"primary",onClick:e[0]||(e[0]=l=>I("create"))},{default:s(()=>e[10]||(e[10]=[y("新增物种")])),_:1}),t(i,{type:"success",onClick:T},{default:s(()=>e[11]||(e[11]=[y("导出Excel")])),_:1}),t(B,{columns:C,data:_(o).items,total:_(o).pagination.total,"page-size":_(o).pagination.limit,loading:_(o).loading,"show-actions":!0,onPageChange:U,onSizeChange:E,onEdit:e[1]||(e[1]=l=>I("edit",l)),onDelete:D},null,8,["data","total","page-size","loading"]),t(v,{modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=l=>p.value=l),title:_(V)},{footer:s(()=>[t(i,{onClick:e[8]||(e[8]=l=>p.value=!1)},{default:s(()=>e[12]||(e[12]=[y("取消")])),_:1}),t(i,{type:"primary",onClick:h},{default:s(()=>e[13]||(e[13]=[y("确认")])),_:1})]),default:s(()=>[t(f,{model:a,rules:S,ref_key:"formRef",ref:g},{default:s(()=>[t(u,{label:"科名",prop:"family"},{default:s(()=>[t(r,{modelValue:a.family,"onUpdate:modelValue":e[2]||(e[2]=l=>a.family=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"属名",prop:"genus"},{default:s(()=>[t(r,{modelValue:a.genus,"onUpdate:modelValue":e[3]||(e[3]=l=>a.genus=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"学名",prop:"scientific_name"},{default:s(()=>[t(r,{modelValue:a.scientific_name,"onUpdate:modelValue":e[4]||(e[4]=l=>a.scientific_name=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"中文名",prop:"chinese_name"},{default:s(()=>[t(r,{modelValue:a.chinese_name,"onUpdate:modelValue":e[5]||(e[5]=l=>a.chinese_name=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"保护级别",prop:"conservation_status"},{default:s(()=>[t(x,{modelValue:a.conservation_status,"onUpdate:modelValue":e[6]||(e[6]=l=>a.conservation_status=l)},{default:s(()=>[t(c,{label:"无危",value:"无危"}),t(c,{label:"易危",value:"易危"}),t(c,{label:"濒危",value:"濒危"})]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"分布信息"},{default:s(()=>[t(r,{modelValue:a.distribution,"onUpdate:modelValue":e[7]||(e[7]=l=>a.distribution=l),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{K as default};
