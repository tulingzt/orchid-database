import{d as C,r as c,a as g,c as U,b as o,w as s,e as n,o as _,g as w,h as E,j as B,k as N,i,l as q,E as V,f as A}from"./index-CrBMAzv8.js";const K={class:"auth-container"},R={class:"text-center"},I=C({__name:"Register",setup(F){const v=A(),m=c(),u=c(!1),r=g({username:"",password:"",confirmPassword:"",role:"user",adminSecret:""}),y=g({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在3到20个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在6到20个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(d,e,a)=>{e!==r.password?a(new Error("两次输入密码不一致")):a()},trigger:"blur"}],adminSecret:[{validator:(d,e,a)=>{r.role==="admin"&&!e?a(new Error("管理员必须输入密钥")):a()},trigger:"blur"}]}),p=async()=>{var d,e,a;try{await((d=m.value)==null?void 0:d.validate()),u.value=!0;const l={username:r.username,password:r.password,admin_secret:r.role==="admin"?r.adminSecret:void 0};await q.register(l),V.success("注册成功，请登录"),v.push("/login")}catch(l){V.error(((a=(e=l.response)==null?void 0:e.data)==null?void 0:a.message)||"注册失败")}finally{u.value=!1}};return(d,e)=>{const a=n("el-input"),l=n("el-form-item"),f=n("el-radio"),b=n("el-radio-group"),x=n("el-button"),k=n("el-link"),P=n("el-form"),S=n("el-card");return _(),U("div",K,[o(S,{class:"auth-box"},{default:s(()=>[e[10]||(e[10]=w("h2",{class:"auth-title"},"用户注册",-1)),o(P,{ref_key:"registerForm",ref:m,model:r,rules:y,onKeyup:E(p,["enter"])},{default:s(()=>[o(l,{prop:"username"},{default:s(()=>[o(a,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=t=>r.username=t),placeholder:"用户名","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),o(l,{prop:"password"},{default:s(()=>[o(a,{modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=t=>r.password=t),type:"password",placeholder:"密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(l,{prop:"confirmPassword"},{default:s(()=>[o(a,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=t=>r.confirmPassword=t),type:"password",placeholder:"确认密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(l,{prop:"role"},{default:s(()=>[o(b,{modelValue:r.role,"onUpdate:modelValue":e[3]||(e[3]=t=>r.role=t)},{default:s(()=>[o(f,{label:"user"},{default:s(()=>e[6]||(e[6]=[i("普通用户")])),_:1}),o(f,{label:"admin"},{default:s(()=>e[7]||(e[7]=[i("管理员")])),_:1})]),_:1},8,["modelValue"])]),_:1}),r.role==="admin"?(_(),B(l,{key:0,prop:"adminSecret"},{default:s(()=>[o(a,{modelValue:r.adminSecret,"onUpdate:modelValue":e[4]||(e[4]=t=>r.adminSecret=t),placeholder:"管理员密钥","prefix-icon":"Key"},null,8,["modelValue"])]),_:1})):N("",!0),o(l,null,{default:s(()=>[o(x,{type:"primary",class:"w-full",loading:u.value,onClick:p},{default:s(()=>e[8]||(e[8]=[i(" 立即注册 ")])),_:1},8,["loading"])]),_:1}),w("div",R,[o(k,{type:"primary",onClick:e[5]||(e[5]=t=>d.$router.push("/login"))},{default:s(()=>e[9]||(e[9]=[i(" 已有账号？立即登录 ")])),_:1})])]),_:1},8,["model","rules"])]),_:1})])}}});export{I as default};
