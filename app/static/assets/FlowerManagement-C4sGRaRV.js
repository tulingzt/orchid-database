import{u as v,w as T,F as U}from"./FileSaver.min-DV60ARKV.js";import{u as z}from"./flower-BR98JsfF.js";import{D as B}from"./DataTable-4gAKRNCn.js";import{d as q,r as f,a as N,c as $,b as a,w as n,e as _,m as c,o as j,i as g}from"./index-CrBMAzv8.js";const O={class:"management-container"},H=q({__name:"FlowerManagement",setup(P){const o=z(),m=f(!1),h=f(""),b=f(),w=f(null),V=f("create"),x=[{prop:"flower_id",label:"ID",width:80},{prop:"species_id",label:"物种ID"},{prop:"flower_length",label:"长度(cm)",width:120},{prop:"flower_width",label:"宽度(cm)",width:120},{prop:"flower_ratio",label:"长宽比",width:120},{prop:"flower_area",label:"面积(cm²)",width:120}],r=N({species_id:0,flower_length:0,flower_width:0,flower_area:void 0}),k={species_id:[{required:!0,message:"请选择物种",trigger:"blur"}],flower_length:[{required:!0,validator:(t,e)=>e>0,message:"长度必须大于0",trigger:"blur"}],flower_width:[{required:!0,validator:(t,e)=>e>0,message:"宽度必须大于0",trigger:"blur"}]},y=(t,e)=>{var i;V.value=t,h.value=t==="create"?"新增花朵":"编辑花朵",t==="edit"&&e?(w.value=e.flower_id,Object.assign(r,{species_id:e.species_id,flower_length:e.flower_length,flower_width:e.flower_width,flower_area:e.flower_area})):(w.value=null,(i=b.value)==null||i.resetFields()),m.value=!0},I=async()=>{await b.value.validate();try{V.value==="create"?await o.createItem(r):w.value&&await o.updateItem(w.value,r),m.value=!1,o.fetchItems()}catch(t){console.error(t)}},C=async t=>{try{await o.deleteItem(t.flower_id),o.fetchItems()}catch(e){console.error(e)}},D=t=>{o.pagination.page=t,o.fetchItems()},S=t=>{o.pagination.limit=t,o.fetchItems()},F=()=>{const t=o.items.map(u=>{const p={};return x.forEach(l=>{if(l.prop==="flower_ratio"){const E=u.flower_length/u.flower_width;p[l.label]=Number(E.toFixed(2))}else p[l.label]=u[l.prop]}),p}),e=v.json_to_sheet(t),i=v.book_new();v.book_append_sheet(i,e,"花朵数据");const s=T(i,{bookType:"xlsx",type:"array"}),d=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});U.saveAs(d,`花朵数据_${new Date().toISOString().slice(0,10)}.xlsx`)};return o.fetchItems(),(t,e)=>{const i=_("el-button"),s=_("el-input-number"),d=_("el-form-item"),u=_("el-form"),p=_("el-dialog");return j(),$("div",O,[a(i,{type:"primary",onClick:e[0]||(e[0]=l=>y("create"))},{default:n(()=>e[8]||(e[8]=[g("新增花朵")])),_:1}),a(i,{type:"success",onClick:F},{default:n(()=>e[9]||(e[9]=[g("导出Excel")])),_:1}),a(B,{columns:x,data:c(o).items,total:c(o).pagination.total,"page-size":c(o).pagination.limit,loading:c(o).loading,"show-actions":!0,onPageChange:D,onSizeChange:S,onEdit:e[1]||(e[1]=l=>y("edit",l)),onDelete:C},null,8,["data","total","page-size","loading"]),a(p,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=l=>m.value=l),title:h.value},{footer:n(()=>[a(i,{onClick:e[6]||(e[6]=l=>m.value=!1)},{default:n(()=>e[10]||(e[10]=[g("取消")])),_:1}),a(i,{type:"primary",onClick:I},{default:n(()=>e[11]||(e[11]=[g("确认")])),_:1})]),default:n(()=>[a(u,{model:r,rules:k,ref_key:"formRef",ref:b},{default:n(()=>[a(d,{label:"物种ID",prop:"species_id"},{default:n(()=>[a(s,{modelValue:r.species_id,"onUpdate:modelValue":e[2]||(e[2]=l=>r.species_id=l),min:1},null,8,["modelValue"])]),_:1}),a(d,{label:"花朵长度(cm)",prop:"flower_length"},{default:n(()=>[a(s,{modelValue:r.flower_length,"onUpdate:modelValue":e[3]||(e[3]=l=>r.flower_length=l),min:.1,precision:2},null,8,["modelValue"])]),_:1}),a(d,{label:"花朵宽度(cm)",prop:"flower_width"},{default:n(()=>[a(s,{modelValue:r.flower_width,"onUpdate:modelValue":e[4]||(e[4]=l=>r.flower_width=l),min:.1,precision:2},null,8,["modelValue"])]),_:1}),a(d,{label:"花朵面积(cm²)"},{default:n(()=>[a(s,{modelValue:r.flower_area,"onUpdate:modelValue":e[5]||(e[5]=l=>r.flower_area=l),min:.1,precision:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{H as default};
